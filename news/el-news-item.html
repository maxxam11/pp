<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="el-news-item" attributes="news">
    <template>
        
        <link rel="stylesheet" href="../css/main.css">
        <style>
            .img-base { width: 100%; height: 300px; background-size: cover; background-position: 50% 50%; margin-top:0;}  
            .img-line { width: 100%; margin: 0; padding: 0}
            
            .title, .body p, .date, .link { padding: 0 10px;  word-wrap: break-word; }            
            .title { font-size: 120%; }            
            .body {color: #111; margin: 0; padding: 0;}
            a {color: #00BCD4;}
            .date { color: grey; padding-bottom: 15px; }
        </style>       
          
        <div class="img-base" style="{{ news.imgUrl ? '' : 'height: 0;'}}background-image: url('{{news.imgUrl}}');"></div>
        
        <h1 id="title" class="title">{{news.title}}</h1>
        <div class="body" id="body">{{news.body}}</div>
        <div class="date">
            <a id="link" href="{{news.sourceLink}}" onclick="window.open('$1', '_system');return false;">{{news.sourceName ? news.sourceName : news.sourceDomain}}</a> 
            <span id="date">{{news.createDate}}</span>
        </div>
        
        
    </template>
    <script>
        Polymer('el-news-item', {
            attributeChanged: function(){
                this.$.title.innerHTML = this.news.title;
                document.title = this.news.title;
        
                var body = '';
                var p;
                var reLink = /\[a\s(.*?)\]([\s\S]*?)\[\/a\]/g;
                var reImg = /\[img\s(.*?)\]/g;
                for (var i = 0, l = this.news.body.length; i < l; i++) {
                    p = this.news.body[i]; 
                    //p = p.replace(/\n/g, '<br>'); //убрал, т.к. ломает текст
                    p = p.replace(reLink, '<a href="$1" onclick="window.open(\'$1\', \'_system\');return false;">$2</a>');
                    p = p.replace(reImg, '</p><img class="img-line" src="$1"><p>');
                    body += '<p>' + p + '</p>';
                }                
                this.$.body.innerHTML = body;
                
                var link = this.news.sourceName ? this.news.sourceName : this.news.sourceDomain;
                this.$.link.innerHTML = link.toUpperCase();
                        
                var date = this.news.createDate;
                this.$.date.innerHTML = date;
            },       
        });
    </script>
</polymer-element>